#include "stdafx.h"
#include "..\\include\\LFCore.h"
#include "License.h"

#include "base64.h"
#include "rsa.h"
#include "pssr.h"

USING_NAMESPACE(CryptoPP)
USING_NAMESPACE(std)

bool IsLicensed()
{
	////////////////////////////////////////////////
	// Setup
	string message = "MCAxCjA0LzA3LzIwMDQKbGlxdWlkRk9MREVSUwoxCjAuOC4wCmVsZW1lbnQgNSDjgZTliKnn\
lKjjgYTjgZ/jgaDjgY3jgIHjgYLjgorjgYzjgajjgYbjgZTjgZbjgYTjgb7jgZfjgZ/jgIIg\
S8O2bG4KKW3Jx/Wv8jWRIvOCy99L2BpPRtiw+Sa/Y+uhpzSemKaC6uVCNQ2MRpIqDe3Vp8bs\
samay58IwTVTzgR1sPbdZQyUXfmS1+d4pKKxqn9yo2AmNBGQJpTyJsWjXTp1LWBY36b5vuqC\
6CMcIG+FRZ5IHoDess4cv33IWKpfv0WbBEH7gUPkoA/TD/tozzHkoYlVTLoDj9+O3z5ySodF\
i0EJFdBYg0Qs+70O1JdfiAB+nCKqq5Pa0JiQDV9QCHgbSt8LdfBbDrc1p5RAgT8p0d2IQt9u\
SjRDGgBCKznecndGeav/di21k41KmGxZM7WclKWgJTNcjVq9pnAMHKigaYTuz7uFNA5v7j3i\
92fXqHM20h9Y2dDmQUI9YUS6conP6Ma/Oax8bcB0SZbaTF+uMKcaHtfYvpfG9iEVDEhDcSEg\
WHDoVmmR8e6BLVO4gpUr6XrbBftFJ7EOiVIPom9GvD8NcMP4MOd6Q3/Fpb6/Cl7jYcP6mPQY\
H+omO90tOrJIDMRCSmJttZ8YauOuI8WSLuutLxI+rAIFx+zdA7HmWZWpYWe+/D8XqrALhLQS\
EuLbl3U85qU8HI53AC/bXGrI3N9rJ1Cmak6JHYQe3rz8IT8NRvuEFQkfHd1Q4eYKaKAfd/wN\
iwZnrOUljSuWpY1NU3bF42VcsUqmUkZUyhC20Q1SEf8=";
		
	Integer n("745495196278906388636775394847083621342948184497620571684486911233963026358348142924980767925246631723125776567861840016140759057887626699111750486589518844265093743018380979709327527515518976285922706516923147828076538170972730183425557516081175385650534524185881211094278086683594714172177608841889993609400198766281044688600596754569489192345101979343468669802344086907480228591789172201629911453850773648840583343122891763767764228796196156401170554177938285696830486894331437834556251102634591813052294727051913850611273897873094152049052538993868633785883333899830540017013351013051436649700047349078185669990895492280131774298910733408039488338775031855217004993409862255738766029617966149166800537682141977654630013676816397200968712319762658485930029154225302095517962261669873874532952773591788024202484800434032440378140651213784614438189252406134607226451954778487476382220064125800227678929995859762762265522856822435862521744384622820138233752235289143337592718212618381294424731866372596352871531111041688119666919042905495747876323829528637851924273124345938360066547750112529335899447558317824780247359979724026700097382563761302560657179092084838455014801002071816886727980707589178515801870998113718231400298837471.");
	Integer e ("17.");

	////////////////////////////////////////////////
	// Verify and Recover
	RSASS<PSSR, SHA256>::Verifier verifier(n, e);

	string recovered; 

	try {
		StringSource( message, true,
			new Base64Decoder(
				new SignatureVerificationFilter(verifier,
					new StringSink( recovered ),
					SignatureVerificationFilter::THROW_EXCEPTION | SignatureVerificationFilter::PUT_MESSAGE
				) // SignatureVerificationFilter
			) // Base64Decoder
		); // StringSource
	} catch(CryptoPP::Exception &e){
		return false;
	}
	return true;
}
